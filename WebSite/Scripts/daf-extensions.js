/*! 
 * Data Aquarium Framework - Extensions for Desktop UI
 * Copyright 2008-2017 Code On Time LLC; Licensed MIT; http://codeontime.com/license
 */
(function(){var n=Web,t=$("body"),i=$(window);n.SmartTag=function(){this.initialize()};n.SmartTag.prototype={isVisible:function(){return this._visible==!0},initialize:function(){this._visible=!1},_hideMenu:function(){var n=this._tag;n&&n.menu&&($(n.menu).menu("destroy").remove(),$(n.markerSelector).removeClass(n.markerClassName),this.unmark(),n.menu=null,n.items=null)},_createTag:function(){var e=this,i=function(){},r=function(t){n.SmartTag._instance.hide(t)},o=(new Date).getTime()*1e4+621355968000000000,u=function(){return e.open(),!1},f={left:$('<div class="web-smart-tag left"><\/div>').appendTo(t).css({position:"absolute",width:"1px"}).hide().hover(i,r).click(u),top:$('<div class="web-smart-tag top"><\/div>').appendTo(t).css({position:"absolute",height:"1px"}).hide().hover(i,r).click(u),right:$('<div class="web-smart-tag right"><\/div>').appendTo(t).css({position:"absolute",width:"1px"}).hide().hover(i,r).click(u),bottom:$('<div class="web-smart-tag bottom"><\/div>').appendTo(t).css({position:"absolute",height:"1px"}).hide().hover(i,r).click(u),arrow:$('<div class="web-smart-tag arrow"><span class="button"><\/span><\/div>').appendTo(t).css({position:"absolute"}).hide().hover(i,r).click(u),className:null,uniqueClassName:"st-"+o,markerClassName:"m-"+o};return f.selector="."+f.uniqueClassName,f.markerSelector="."+f.markerClassName,$(document).click(function(){e._hideMenu()}),f},exec:function(){var n=this._tag,i,t;n._callback&&(i=$(n.selector),t=n._callback(i),t&&(this._hideMenu(),t[0].select()))},open:function(n){var f,r,o,s,v,u,t,h;if((!n||$(n.currentTarget).is(".smart-tag"))&&(f=this,r=f._tag,r._callback)&&(o=$(r.selector),s=r._callback(o),s&&(v=o.is(r.markerSelector),r.menu&&f._hideMenu(),!v))){o.addClass(r.markerClassName);r.items=s;u=$(r.selector);t=r.menu=f._buildMenu(s,$([]),0);t.menu({select:function(n,t){for(var e=$(t.item).data("path"),o=r.items,i=null,u=0;u<e.length;u++)i=o[e[u]],i.children&&(o=i.children);if(!i.select)return!1;f._hideMenu();i.select()}}).position({my:"left top",at:"left bottom",of:u});h=u.outerWidth();h>t.outerWidth()&&t.outerWidth(h);var e=u.offset(),y=i.scrollLeft(),p=i.width(),w=t.outerWidth();e.left+w>y+p&&(t.position({my:"left top",at:String.format("left-{0} bottom",w-(y+p-e.left)),of:u,collision:"none"}),e=t.offset());var c=t.outerHeight(),b=i.scrollTop(),l=b+i.height();if(e.top+c>l){var k=u.offset(),a=k.top-b,d=l-k.top+u.outerHeight();a>d?(t.outerHeight(c>a?a:c),t.position({my:"left bottom",at:"left top",of:r.selector})):t.outerHeight(l-e.top);t.css("overflow","auto")}t.find("a:first").focus()}},_buildMenu:function(n,i,r){var f=this,u=$(String.format('<ul class="web-smart-tag menu level{0}">',r));return i.length==0&&u.appendTo(t),$(n).each(function(n){var t=this,e,r;(t.text||!t.select)&&(e=i.add(n),r=$("<li><\/li>").appendTo(u).data("path",e),t.text?$('<a href="javascript:"><span class="outer"><span class="inner"><\/span><\/span><\/a>').appendTo(r).find("span.inner").text(t.text):$('<div class="divider"><\/div>').appendTo(r),t.checked&&r.addClass("selected"),t.icon&&r.addClass(t.icon),t.children&&f._buildMenu(t.children,e).appendTo(r))}),u},show:function(n,t,i,r){var u,e,s,c;if(this._paused!=!0){u=this._tag;u||(u=this._tag=this._createTag());u._callback=null;t&&(e=u.className==t,s=u.className&&!e,s&&u.left.removeClass(u.className),e||u.left.addClass(t),s&&u.top.removeClass(u.className),e||u.top.addClass(t),s&&u.right.removeClass(u.className),e||u.right.addClass(t),s&&u.bottom.removeClass(u.className),e||u.bottom.addClass(t),s&&u.arrow.removeClass(u.className),e||u.arrow.addClass(t),u.className=t);this._visible=!0;var f=$(n).addClass(u.uniqueClassName).addClass("smart-tag"),o=f.outerWidth(),l=f.outerHeight()-1,h=-1,a=0;if(f.is(".ui-resizable")&&(a=3),o-=a,h-=a,i){u.containerSelector="#"+i.attr("id");var p=i.offset(),w=i.outerWidth(),v=p.left+w-17,y=f.offset();if(y.left+o-1>v){if(c=v-y.left,c<20){this.hide();return}h=c-o;o=c}u.width=o}u.left.height(l).show().position({my:"left top",at:"left top",of:f,collision:"none"});u.top.width(o).show().position({my:"left top",at:"left top",of:f,collision:"none"});u.right.height(l).show().position({my:"left top",at:String.format("right{0} top",h),of:f,collision:"none"});u.bottom.width(o).show().position({my:"left top",at:"left bottom-1",of:f,collision:"none"});u.arrow.height(l).show().position({my:"right top",at:String.format("right{0} top",h),of:f,collision:"none"});u._callback=r}},is:function(n){if(!this._visible)return!1;var t=this._tag;return t.left[0]==n||t.top[0]==n||t.right[0]==n||t.bottom[0]==n||t.arrow[0]==n},hide:function(n){var i,t,r;this._paused!=!0&&((i=null,n&&(i=n.relatedTarget,i||(i=n.toElement)),t=this._tag,i&&t&&(r=$(i),this.is(i)||r.is(t.selector)))||(this._visible=!1,t&&(this.mark(),t.left.hide(),t.top.hide(),t.right.hide(),t.bottom.hide(),t.arrow.hide(),$(t.selector).removeClass(t.uniqueClassName).removeClass("smart-tag"))))},pause:function(){this.hide();this._hideMenu();this._paused=!0},resume:function(){this._paused=!1},mark:function(){var n=this._tag,i,t;if(n&&(i=$(n.markerSelector),i.length!=0)&&(t=this._marker,t||(t=this._marker=this._createMarker()),!t.visible)){t.visible=!0;t.className=n.className;t.containerSelector=n.containerSelector;t._callback=n._callback;var r=i.outerWidth(),f=i.outerHeight()-1,u=-1,e=0;i.is(".ui-resizable")&&(e=3);r-=e;u-=e;n.width<r&&(u=n.width-r,r=n.width);t.left.addClass(n.className).height(f).show().position({my:"left top",at:"left top",of:i,collision:"none"});t.top.addClass(n.className).width(r).show().position({my:"left top",at:"left top",of:i,collision:"none"});t.right.addClass(n.className).height(f).show().position({my:"left top",at:String.format("right{0} top",u),of:i,collision:"none"});t.bottom.addClass(n.className).width(r).show().position({my:"left top",at:"left bottom-1",of:i,collision:"none"});t.arrow.addClass(n.className).height(f).show().position({my:"right top",at:String.format("right{0} top",u),of:i,collision:"none"})}},_createMarker:function(){var u=this,n=this._marker,f=this._tag,i=function(){u.unmark();u.show($(f.markerSelector),n.className,$(n.containerSelector),n._callback)},r=function(){};return n||(n={left:$('<div class="web-smart-tag left marker"><\/div>').appendTo(t).css({position:"absolute",width:"1px"}).hide().hover(i,r),top:$('<div class="web-smart-tag top marker"><\/div>').appendTo(t).css({position:"absolute",height:"1px"}).hide().hover(i,r),right:$('<div class="web-smart-tag right marker"><\/div>').appendTo(t).css({position:"absolute",width:"1px"}).hide().hover(i,r),bottom:$('<div class="web-smart-tag bottom marker"><\/div>').appendTo(t).css({position:"absolute",height:"1px"}).hide().hover(i,r),arrow:$('<div class="web-smart-tag arrow marker"><span class="button"><\/span><\/div>').appendTo(t).css({position:"absolute"}).hide().hover(i,r)}),n},unmark:function(){var n=this._marker;n&&n.visible&&(n.visible=!1,n.left.hide().removeClass(n.className),n.top.hide().removeClass(n.className),n.right.hide().removeClass(n.className),n.bottom.hide().removeClass(n.className),n.arrow.hide().removeClass(n.className))}};n.SmartTag._instance=new n.SmartTag;jQuery.fn.smartTag=function(t,i){var u=arguments,r=n.SmartTag._instance;if(u.length==2)this.hover(function(){var n=!0;i.test&&(n=i.test());n&&r.show(this,t,i.container,i.items)},function(n){r.hide(n)}).click(function(n){var t=$(n.target);return t.is(".node-button,:input")?!0:(i.select&&i.select(),t.is(".button,.status")?r.exec(n):r.open(n),!1)});else switch(t){case"pause":r.pause();break;case"resume":r.resume();r.hide();break;case"hide":r.hide();r._hideMenu();break;case"destroy":this.off("mouseenter mouseleave click");break;default:throw Error(String.format('Method "{0}" is not supported',t));}return this};n.DataView.Extensions={};$(document).mousedown(function(t){var e=!1,u=$(t.target),r,i,f;u.parent().length!=0&&((r=u.closest(".resizable-data-view"),r.length==0&&(r=u.closest(".DataViewContainer").parent().children(".resizable-data-view")),r.length==0&&u.closest(".HoverMenu,.web-smart-tag").length>0)||(r.length>0&&(i=r.attr("id"),i=i?i.match(/^(.+?)_[a-z]+$/i):null,i=i?i[1]:null,f=i?$find(i):null,f&&(n.DataView.Extensions.active(f.extension(),!0),e=!0)),e||n.DataView.Extensions.active(null,!1)))}).keydown(function(t){var i=n.DataView.Extensions.activeTarget(t);i&&i.keydown(t)}).keyup(function(t){var i=n.DataView.Extensions.activeTarget(t);i&&i.keyup(t)}).keypress(function(t){var i=n.DataView.Extensions.activeTarget(t);i&&i.keydown(t)});n.DataView.Extensions.activeTarget=function(t){var i=n.DataView.Extensions.active();return i&&$(t.target).closest("input,select,textarea,.HoverMenu,.web-smart-tag,.Group,.horizontal-scroll-bar-wrap,.vertical-scroll-bar-wrap").length==0?i:null};n.DataView.Extensions.active=function(t,i){var u,f,r;if(arguments.length==0)return(u=n.DataView._activeExtensionId,!u)?null:(f=$find(u),f?f.extension():null);if(t!=0){if(i==null)return n.DataView._activeExtensionId==t.dataView().get_id();i&&this.active(t)||(r=this.active(),i?(r&&r.deactivate(),n.DataView._activeExtensionId=t.dataView().get_id(),t.activate()):(n.DataView._activeExtensionId=null,r&&r.deactivate(),t&&t.deactivate()))}};(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>7)&&(n.DataView.Extensions.DataSheet=function(t){return new n.DataView.DataSheet(t)});n.DataView.DataSheet=function(n){this.dataView(n)};n.DataView.DataSheet.prototype={initialize:function(){var t=this._dataView,n;for(this._rowHeight=15,n=0;n<t._fields.length;n++)t._fields[n].OnDemand&&(this._rowHeight=75);this._headerHeight=15;this._createContainer();this._frozenFieldName=t.readContext("dataSheetFrozenField")},options:function(){return{actionBar:!0,description:!0}},_createContainer:function(){var n=this._dataView,t=this._id=n.get_id()+"_DataSheet",i,r;this._selector="#"+t;i=n._element;this.$that().remove();r=$("<div><\/div>").attr("id",t).addClass("container data-sheet resizable-data-view").appendTo(i);this.showRowNumber()&&r.addClass("show-row-numbers")},_reset:function(){var n;this._refreshSpeed=null;$().smartTag("hide");var t=this._cellMap,i=this._gapMap,r=this._headerMap,u=this._rowMap;for(n=0;n<t.length;n++)delete t[n],i&&delete i[n],r&&delete r[n],u&&delete u[n];this._$horizontalScrollbar.slider("destroy");this._$verticalScrollbar.slider("destroy");this.$that().find(".header-cell,.data-cell,span.showing").smartTag("destroy");this._$dataRows.unbind();this._viewId=null;this._dataView._lastExtension=null;this._cursor=null;this.rowRange(null)},rowRange:function(n,t){if(n=="current"){if(!t)return this._currentRowRange;this._lastRowRange=this._currentRowRange;this._currentRowRange=t}else if(n=="last"){if(!t)return this._lastRowRange;this._lastRowRange=t}else this._lastRowRange=null,this._currentRowRange=null},rowHeight:function(){return this._rowHeight},headerHeight:function(){return this._headerHeight},charWidth:function(t){var r,i;if(t==0&&(t=15),r=n.DataView.DataSheet,i=r._charWidth,i==null){var u="abcdefghijklmnopqrstuvwzyz0123456789",f=$('<div class="data-row"><div class="data-cell"><div class="data-item"><\/div><\/div><\/div>').appendTo(this.$that()),e=f.find(".data-item").text(u).width();r._charWidth=i=Math.ceil(e/u.length);f.remove()}return t?i*t:i},$that:function(n){var t=this._selector;return n&&(n.charAt(0)!="_"&&(n=" "+n),t+=n),$(t)},dataView:function(n){if(n==null)return this._dataView;this._dataView=n},show:function(){var s=this._dataView,f=s.get_viewId(),t,n,u;if(this._viewId!=f||this.pageSize()!=this._lastPageSize?(this._viewId=f,this._allocateCells()):this.$that().show(),this._$sliderPageInfo.hide(),this.lookup()){t=this.$that();n=t.parents(".ModalPlaceholder").find(".HeaderText table:first");n.width("100%");var e=this.$that(".header-row .header-cell:last"),h=e.position(),c=e.outerWidth(),o=h.left+c,l=t.outerWidth(),r=i.width()/5*4;o>r&&(o=r);u=r-l;u>0&&(n.parent().outerWidth(n.outerWidth()+u),this.autoSize(!1));this.cursor(!0)}this.autoSize(!1)},hide:function(){this.$that().hide()},activate:function(){this.cursor(!0)},deactivate:function(){this.cursor(!1)},keydown:function(n,t){var h,d,k,p,l;if(this._skipKeyDown){this._skipKeyDown=!1;return}if(h=!1,this.busy())h=!0;else{var v=this._$horizontalScrollbar,a=this.cursor(),c=this.totalRowCount(),r=this.topRowIndex(),s=this.pageSize(),g=this.dataView()._fields,y=g.length-1,f=a.col,i=a.row,u=null;switch(n.keyCode){case 40:u="Down";break;case 38:u="Up";break;case 39:u="Right";break;case 37:u="Left";break;case 34:u="PageDown";break;case 33:u="PageUp";break;case 13:u=n.shiftKey?"ShiftEnter":"Enter";break;case 9:u=n.shiftKey?"ShiftTab":"Tab";break;case 36:u=n.ctrlKey?"CtrlHome":"Home";break;case 35:u=n.ctrlKey?"CtrlEnd":"End"}u&&!t&&navigator.userAgent.match(/webkit/)&&(d=this._lastKey==u,this._lastKey=u,k=(new Date).getTime(),p=this._refreshSpeed,p=p?p*1.5:100,d&&k-this._lastKeyTime<p?(u=null,h=!0):this._lastKeyTime=k);switch(u){case"Down":case"Enter":u=="Enter"&&n.ctrlKey?this.rowCommand(a.row-r,"Select"):a.row<c-1&&(i++,this.cursor(!0,i,f),r+s-1<i?this.scrollTopRow(i-s+1):i<r&&this.scrollTopRow(i));h=!0;break;case"Up":case"ShiftEnter":i>0&&(i--,this.cursor(!0,i,f),i<r?this.scrollTopRow(i):i>r+s-1&&this.scrollTopRow(i-s+1));h=!0;break;case"Right":case"Tab":if(a.col<y||t){f++;f>y&&(f=y);this.cursor(!0,i,f);for(var o=this.cell(0,f),w=this._$verticalScrollbar.offset(),b=v.slider("option"),e=o.is(":visible")?b.value:-1;;)if(l=o.offset(),!o.is(":visible")||l.left+o.outerWidth()>=w.left){if(e==b.max)break;e++;v.slider("option","value",e);this.hScroll(e)}else break}else u=="Tab"&&i<c-1&&(this.cursor(!0,i,0),n.keyCode=37,this.keydown(n,!0),n.keyCode=40,this.keydown(n));!n.ctrlKey&&(i<r||i>r+s-1)&&this.makeCursorVisible();h=!0;break;case"Left":case"ShiftTab":if(a.col>0||t){for(f--,f<0&&(f=0),this.cursor(!0,i,f),o=this.cell(0,f),w=this._$verticalScrollbar.offset(),b=v.slider("option"),e=b.value;;){if(l=o.offset(),o.is(":visible")&&l.left+o.outerWidth()<w.left)break;if(e--,e<0)break;v.slider("option","value",e);this.hScroll(e)}if(!o.is(":visible")||l.left+o.outerWidth()>=w.left)for(e=b.max;;){if(l=o.offset(),o.is(":visible")&&l.left+o.outerWidth()<w.left)break;if(e--,e<0)break;v.slider("option","value",e);this.hScroll(e)}}else u=="ShiftTab"&&i>0&&(this.cursor(!0,i,y),n.keyCode=39,this.keydown(n,!0),n.keyCode=38,this.keydown(n));!n.ctrlKey&&(i<r||i>r+s-1)&&this.makeCursorVisible();h=!0;break;case"PageDown":i+=s;i>c-1&&(i=c-1);this.cursor(!0,i,f);r+=s;r+s>c&&(r=c-s);r<0&&(r=0);this.scrollTopRow(r);h=!0;break;case"PageUp":i-=s;i<0&&(i=0);this.cursor(!0,i,f);r-=s;r<0&&(r=0);this.scrollTopRow(r);h=!0;break;case"Home":case"CtrlHome":n.ctrlKey&&(i=0);this.cursor(!0,i,0);n.keyCode=37;this.keydown(n,!0);n.ctrlKey&&this.makeCursorVisible();break;case"End":case"CtrlEnd":n.ctrlKey&&(i=c-1);this.cursor(!0,i,y);n.keyCode=39;this.keydown(n,!0);n.ctrlKey&&this.makeCursorVisible()}}h&&n.preventDefault&&(n.preventDefault(),n.stopPropagation(),this._skipKeyDown=navigator.userAgent.match(/Firefox/)&&!t)},makeCursorVisible:function(){var u=this.cursor(),n=this.topRowIndex(),i=this.pageSize(),f=u.row,o=this.totalRowCount(),r,s,h,e,t;(f<n||f>n+i-1)&&(n=f-Math.floor(i/2),n+i>=o&&(n=o-i),n<0&&(n=0),this.scrollTopRow(n));r=this.cell(u.row-n,u.col);r.length>0&&(s=r.offset(),h=this._$verticalScrollbar.offset(),s.left+r.outerWidth()>=h.left&&(e=this._$horizontalScrollbar,t=e.slider("option"),t.value++<t.max-1&&(e.slider("option","value",t.value),this.hScroll(t.value))))},keypress:function(){},keyup:function(n){var t=n.which,e=t==189||t==109||t==187||t==107||t==173||t==61;if(e&&n.altKey&&n.shiftKey){var u=this.topRowIndex(),i=this.cursor(),o=this.cell(i.row-u,i.col),r=o.find(".node-button"),f=r.is(".collapsed");r.length>0&&!r.is(".terminal")&&(!f&&(t==189||t==109||t==173)||f&&(t==187||t==107||t==61))&&($().smartTag("hide"),this.execute("node-button",i.row-u,i.col,"click",r[0]),n.preventDefault(),n.stopPropagation())}},field:function(n){return this._dataView.findField(n)},fieldUnderAlias:function(n){return this._dataView.findFieldUnderAlias(this.field(n))},hierarchyField:function(){return this._hierarchyField},visibleDataRows:function(n){var w=this._dataView,u=null,f=null,l=null,i=n,a,s,t,r,c,o;i==null&&(i=this.pageIndex());a=w._cachedPages;s=this.pageCount();s==1&&this.pageOffset(0);var e=this.pageOffset(),v=e>0&&i<s-1,k=this.hierarchyField()!=null,y=i==s-1&&i>0;for(t=0;t<a.length;t++)if(r=a[t],r.index==i?u=r:v&&r.index==i+1?f=r:(y||k)&&r.index==i-1&&(l=r),u&&(v&&f||y&&l))break;if(!u||v&&!f||y&&!l)return null;n!=null&&w.set_pageIndex(n);var h=[],b=u.index*this.pageSize()+e,p=b-1;for(t=e;t<u.rows.length;t++)Array.add(h,u.rows[t]),p++;if(this._bottomInvisibleRow=null,f){for(c=f.rows,o=c.length,o>e&&(o=e),t=0;t<o;t++)Array.add(h,c[t]),p++;this._bottomInvisibleRow=c[o]}return this.rowRange("current",{first:b,last:p,rows:h}),h},wait:function(n){var t=this._$pagerRefresh;t&&(n||n==null?t.addClass("wait"):t.removeClass("wait"))},busy:function(){return this._dataView._isBusy},row:function(n){var t=this._rowMap,i,r;return t||(t=this._rowMap=[]),i=t[n],i||(r=this.$that(String.format("_R{0}",n)),i=t[n]=r),i},cell:function(n,t){var r=this._cellMap,i,u;return r||(r=this._cellMap=[]),i=r[n],u=i?i[t]:null,u||(i||(i=r[n]=[]),u=i[t]=this.$that(String.format("_R{0}_C{1}",n,t))),u},gap:function(n){var t=this._gapMap,i,r;return t||(t=this._gapMap=[]),i=t[n],i||(r=this.$that(String.format("_RG{0}",n)),i=t[n]={gap:r,status:r.find(".status"),number:r.find(".number")}),i},header:function(n){var t=this._headerMap,i,r;return t||(t=this._headerMap=[]),i=t[n],i||(r=this.$that(String.format("_H{0}",n)),i=t[n]=r),i},refresh:function(t){var f=this._dataView,l=f._fields,i,o,v,tt,y,r,it,at,rt,h,p,w,b,vt,c,ut,k,yt,ft,d,et;if(!t&&(t=this.visibleDataRows(),t==null)){f.goToPage(f.get_pageIndex(),!0);return}var s=this.rowRange("last"),u=this.rowRange("current"),a=[],g=this.pageSize(),ot=this.showRowNumber(),pt=this.multiSelect(),wt=this.topRowIndex(),nt=this.hierarchyField(),bt=this.keyField(),e=new Sys.StringBuilder;f._disableObjectRef=!0;var st=this.systemFilter(),ht=n.DataViewResources.Form,ct=f._hasKey(),lt=!this._refreshSpeed;if(lt&&(this._refreshSpeed=(new Date).getTime()),s&&u)if(s.first==u.first&&s.last==u.last)for(i=0;i<g;i++)a.push(i);else for(o=u.first<s.first?u.last:u.first,v=o==u.last?-1:1;v>0&&o<=u.last||v<0&&o>=u.first;){if(s.first<=o&&o<=s.last&&(tt=o-u.first,y=o-s.first,0<=y&&y<g)){for(r=0;r<l.length;r++)it=this.cell(tt,r),at=this.cell(y,r),it.empty(),rt=at[0].childNodes,rt.length>0&&it[0].appendChild(rt[0]);a.push(tt)}o+=v}for(i=0;i<t.length;i++){if(h=t[i],a.length==0||!Array.contains(a,i))for(r=0;r<l.length;r++)p=l[r],p=f._allFields[p.Index],e.append('<div class="data-item">'),w=!1,r==0&&(pt&&e.appendFormat('<input type="checkbox" class="checkbox"/>'),ct&&(w=!0),nt&&(b=h[nt.Index],b&&(vt=b.split("/"),c=t[i+1],c||(c=this._bottomInvisibleRow),ut=c?c[nt.Index]:null,k=st&&Array.contains(st,h[bt.Index]),e.appendFormat('<span style="margin-left:{0}px;" class="button node-button{1}{2}" title="{3}"><\/span>',(vt.length-1)*16,(!ut||b.length>=ut.length)&&!k?" terminal":"",k?" collapsed":"",k?ht.Maximize:ht.Minimize)))),w&&e.append('<span class="button">'),f._renderItem(e,p,h,!1,null,!1),w&&e.append("<\/span>"),e.append("<\/div>"),yt=this.cell(i,r),yt[0].innerHTML=e.toString(),e.clear();ft=this.row(i).removeClass("empty");ct&&(f.rowIsSelected(h)?ft.addClass("selected"):ft.removeClass("selected"));ot&&this.gap(i).number.text(wt+i+1)}for(f._disableObjectRef=!1,i=t.length;i<g;i++){for(r=0;r<l.length;r++)this.cell(i,r).empty();this.row(i).removeClass("selected").addClass("empty");ot&&this.gap(i).number.text("")}this._syncVScrollBar();this.wait(!1);lt&&(this._refreshSpeed=(new Date).getTime()-this._refreshSpeed);d=this.cursor();et=this.totalRowCount();d&&d.row>=et?this.cursor(!0,et-1,d.col):this.cursor(!0)},reset:function(n){n&&this.pageOffset(0);this.rowRange(null)},fixedColumns:function(){for(var t,i=this._frozenFieldName,r=this._dataView._fields,n=0;n<r.length;n++)if(t=r[n],t.Name==i||!i&&t.tagged("data-sheet-freeze"))return n+1;return 0},freeze:function(n){var i=this._dataView,t;if(n==null)return(t=this.fixedColumns(),t==0)?null:i._fields[t-1].Name;n==""&&(n=null);i.writeContext("dataSheetFrozenField",n);this._frozenFieldName=n;this._reset();this.show();this.refresh()},_freeze:function(){var n=this.fixedColumns();this.$that().find("div.data-row").each(function(){$(String.format("div.data-cell:lt({0})",n),this).addClass("fixed")})},_allocateCells:function(){var r=this,u,o,s,rt,p,c,w,l,ut,d,ft,g,nt,et,tt,lt,b;this._createContainer();var f=this._dataView,k=f._fields,st=f._allFields,wt=f._rows,bt=f.get_pageCount(),a=f.get_pageSize();this._lastPageSize=a;var v=this.totalRowCount(),ht=this.headerHeight(),ct=this.rowHeight();for(u=0;u<st.length;u++)o=st[u],o.tagged("hierarchy-organization")&&(this._hierarchyField=o);s=f.readContext("dataSheetColumnWidth");rt=s==null;rt&&(s=[]);var vt=0,h=this._id,e=new Sys.StringBuilder,y=3;for(this.showRowNumber()&&(y+=v.toString().length),y=this.charWidth(y),e.appendFormat('<div id="{0}_H" class="header-row"><div id="{0}_HG" class="header-gap" style="position:relative;height:{1}px;width:{2}px"><span><\/span><\/div>',h,ht,y),u=0;u<k.length;u++)o=k[u],o=f._allFields[o.AliasIndex],rt?(p=this.charWidth(o.Columns),s[u]=p):p=s[u],vt+=p,e.appendFormat('<div id="{0}_H{1}" class="header-cell c{1}" style="position:relative;width:{2}px;height:{3}px"><\/div>',h,u,p,ht);for(e.append("<\/div>"),c=0;c<a;c++){for(w="",c==0&&(w+=" first"),c==a-1&&(w+=" last"),c%2!=0&&(w+=" alternating"),e.appendFormat('<div id="{0}_R{1}" class="data-row{3}"><div id="{0}_RG{1}" class="data-gap" style="position:relative;height:{2}px;width:{4}px"><div class="gap-item"><span class="status">&nbsp;<\/span><span class="number"><\/span><\/div><\/div>',h,c,ct,w,y),u=0;u<k.length;u++)o=k[u],o=f._allFields[o.AliasIndex],e.appendFormat('<div id="{0}_R{1}_C{2}" class="data-cell c{2}" style="position:relative;width:{3}px;height:{4}px"><!--r{1}, c{2}--><\/div>',h,c,u,s[u],ct);e.append("<\/div>")}e.append("<\/div>");e.appendFormat('<div id="{0}_HSB" class="horizontal-scroll-bar-wrap"><div class="scroll-bar"><\/div><\/div>',h);e.appendFormat('<div id="{0}_Pager" class="pager"><span class="showing"><\/span><span title="Refresh" class="refresh"><\/span><\/div>',h);e.appendFormat('<div id="{0}_VSB" class="vertical-scroll-bar-wrap"><div class="scroll-bar"><\/div><\/div>',h);l=this.$that();ut=l.outerWidth();l.show().html(e.toString());d=r.sort();$(".header-cell",l).each(function(t){var i=r._dataView._fields[t],u,f;i=r._dataView._allFields[i.AliasIndex];t==0&&r.multiSelect()&&$('<input type="checkbox" class="checkbox"/>').appendTo(this);i.AllowSorting?(u=$('<span class="button"><\/span>').appendTo(this).text(i.HeaderText).attr("title",String.format(n.DataViewResources.HeaderFilter.SortBy,i.HeaderText)),f=$('<span class="status"><\/span>').appendTo(u),d&&d.fieldName==i.Name&&f.addClass(d.order!="desc"?"sort-asc":"sort-desc")):$(this).text(i.HeaderText)});e.clear();ft=this.$that("div.header-row");g=0;this._$headerCells=$(ft).find("div.header-cell,div.header-gap").each(function(n){var t=$(this);g+=t.outerWidth();n==0&&(nt=t.outerHeight());n>0&&t.resizable({handles:"e",maxWidth:ut-50,alsoResize:String.format("#{0} div.data-cell.c{1}",h,n-1),resize:function(t,i){s[n-1]=i.size.width;f.writeContext("dataSheetColumnWidth",s);r.cursor(!0)},start:function(){},stop:function(){r.autoSize(!0);$().smartTag("resume")}}).find(".ui-resizable-handle").mousedown(function(){$().smartTag("pause")}).mouseup(function(){$().smartTag("resume")}).dblclick(function(t){var u=$(t.target),e=u.css("cursor"),i;u.css("cursor","default");i=0;r.$that(String.format("div.data-cell.c{0} div.data-item",n-1)).each(function(){var n=$(this),r=n.css("position"),t;n.css("position","absolute");t=n.outerWidth();n.css("position",r);t>i&&(i=t)});i<ut-20&&(s[n-1]=i,$(String.format("#{0} div.header-cell.c{1}, #{0} div.data-cell.c{1}",h,n-1)).width(i),r.autoSize(!0),$().smartTag("resume"),f.writeContext("dataSheetColumnWidth",s),r.cursor(!0));u.css("cursor",e)})});ft.height(nt);et=this._$dataRows=this.$that("div.data-row").each(function(){var n=this,t;g=0;t=$("div.data-cell,div.data-gap",n).each(function(n){var t=$(this);g+=t.outerWidth();n==0&&(nt=t.outerHeight())});$(n).height(nt);t.css("top",0)}).click(function(n){var t=$(n.target),u=parseInt($(this).attr("id").match(/_R(\d+)$/)[1]),f=r.cellIndex(t),i="row";action="click";t.is(".node-button")&&(i="node-button");r.execute(i,u,f,action,n.target)});this._$dataGaps=this.$that("div.data-gap");tt=navigator.userAgent.match(/Firefox/)==!0;lt=tt?"wheel":"mousewheel";et.bind(lt,function(n){var u=n.originalEvent?n.originalEvent.wheelDelta/120:null,f,i,t,e,o;u==null&&(u=n.originalEvent.deltaY!=null?n.originalEvent.deltaY:null);u!=null&&r.pageCount()>1&&($().smartTag("pause"),r.busy()||(f=Math.ceil(Math.abs(u)),i=n.originalEvent.wheelDeltaX,i==null&&(i=n.originalEvent.deltaX!=null?n.originalEvent.deltaX:null),i!=null&&i!=0?(tt||(i*=-1),n.keyCode=i>0?37:39,n.ctrlKey=!0,r.keydown(n)):(tt&&(u*=-1),t=r.topRowIndex(),e=r.pageSize(),u<0?(t=t+f,o=r.totalRowCount(),t+e>o&&(t=o-e),t<0&&(t=0),r.scrollTopRow(t)):(t=t-f,t<0&&(t=0),r.scrollTopRow(t)))),n.preventDefault(),n.stopPropagation(),$().smartTag("resume"))});this.$that(".header-cell").each(function(n){$(this).smartTag("header-cell",{container:l,items:function(){return r._contextMenuOfColumn(n)}})});et.each(function(n){$(this).find(".data-cell.c0").smartTag("data-cell",{container:l,items:function(){return r._contextMenuOfDataRow(n)},test:function(){var t=r.absoluteRowIndex(n);return t<r.totalRowCount()},select:function(){var t=r.absoluteRowIndex(n);v=r.totalRowCount();t>=v&&(t=v-1);r.cursor(!0,t,0)}})});this._$pageShowing=this.$that("div.pager span.showing").smartTag("pager-menu",{container:l,items:function(){var t=[];return $(n.DataViewResources.Pager.PageSizes).each(function(){var i=this;t.push({text:String.format("{0} {1}",n.DataViewResources.Pager.ItemsPerPage,this),checked:this==f.get_pageSize(),select:function(){r.pageSize(i)}})}),t}});this._freeze();b=this._$horizontalScrollbar=this.$that("_HSB .scroll-bar");b.slider({orientation:"horizontal",min:0,max:0,value:0,animate:100,slide:function(n,t){r.hScroll(t.value)},start:function(){$().smartTag("pause")},stop:function(){$().smartTag("resume");b.width("100%")}});var yt=b.find(".ui-slider-handle").mousedown(function(){b.width(pt.width())}),pt=yt.append('<div class="ui-handle-helper"><\/div>').wrap('<div class="ui-slider-handle-parent"><\/div>').parent(),kt=this.$that("div.data-row.last"),ot=this._$sliderPageInfo=$("<div><\/div>").addClass("data-sheet pager-info-popup").css({position:"absolute"}).hide().appendTo(t);r._pageInfoTimeout=-1;r.pageInfoSlideTimeout=null;var at=this._$verticalScrollbar=this.$that("_VSB .scroll-bar").slider({orientation:"vertical",min:0,max:v<=a?0:v-a,animate:100,value:f.get_pageIndex()*a+r.pageOffset(),slide:function(n,t){r._skipSyncVScrollBar=!0;var i=r.scrollTopRow(t.value,!0);r._pageInfoSlideTimeout||(r._pageInfoSlideTimeout=setTimeout(function(){ot.show().position({my:"right-8 middle",at:"left middle",of:it});r._pageInfoSlideTimeout=null},50));r._pageInfoTimeout!=-1&&clearTimeout(r._pageInfoTimeout);r._updatePageInfo(i)},change:function(){ot.show().position({my:"right-8 middle",at:"left middle",of:$(this).find(".ui-slider-handle")})},start:function(){if(r.busy())return!1;$().smartTag("pause")},stop:function(){$().smartTag("resume");r._pageInfoTimeout=setTimeout(function(){ot.hide()},1e3);r.resetVScrollBar&&(r.$that("_VSB .scroll-bar").height("100%").css({"margin-top":0}),r._$vSliderHandleParent.css("margin-top",+it.height()/2),r.resetVScrollBar=!1)}}),it=this._$vSliderHandle=at.find(".ui-slider-handle").mousedown(function(){at.slider("option","max")>0&&(r.resetVScrollBar=!0,r.$that("_VSB .scroll-bar").height(r._$vSliderHandleParent.height()).css({"margin-top":+it.height()/2}),r._$vSliderHandleParent.css("margin-top",0))}),dt=this._$vSliderHandleParent=it.append('<div class="ui-handle-helper"><\/div>').wrap('<div class="ui-slider-handle-parent"><\/div>').parent();this._$pagerRefresh=this.$that("_Pager .refresh").click(function(){return r.busy()||(f._hasSearchAction?f.search():f.sync()),!1});this.autoSize();(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>=9)&&i.resize(function(){r.autoSize(!0)})},cellIndex:function(n){var t=$(n).parent(".data-cell",".data-cell").andSelf().attr("id"),i=t?t.match(/_C(\d+)$/):null;return i==null?-1:parseInt(i[1])},hScroll:function(n){var t=this,i=t.fixedColumns(),r=i==0?"":String.format(":gt({0})",i-1);t.$that("div.data-cell").show();t.$that("div.header-cell").show();t.$that(String.format("div.header-row div.header-cell:lt({0}){1}",n+i,r)).hide();this._$dataRows.each(function(){$(this).find(String.format("div.data-cell:lt({0}){1}",n+i,r)).hide()});$().smartTag("hide");t.cursor(!0)},keyField:function(){var t=this._dataView,n=t._keyFields;return n.length>0?n[0]:null},topRowIndex:function(){return this.pageIndex()*this.pageSize()+this.pageOffset()},absoluteRowIndex:function(n){return n+this.topRowIndex()},execute:function(n,t,i,r){var f,e,u,h,o,s;if(!this.busy())if(f=this._dataView,n=="node-button"){var c=this.keyField(),l=this.rowRange("current").rows,a=l[t][c.Index];r=="click"&&(this.systemFilter(a),f._clearCache(!1),f._requiresRowCount=!0,f.goToPage(this.pageIndex()))}else e=this.totalRowCount(),u=this.absoluteRowIndex(t),u>=e&&(u=e-1),i>=0?(this.cursor(!0,u,i),this.makeCursorVisible()):(h=this.cursor(),i=h.col,o=this.cell(t,i),(!o.is(":visible")||o.offset().left>this._$verticalScrollbar.offset().left)&&(s=$(this._$dataRows[t]).find(".data-cell:visible"),s.length>0&&(i=this.cellIndex(s[0]))),this.cursor(!0,u,i),this.rowCommand(t,"Select"))},rowCommand:function(n,t,i){var f=this._dataView,r=this.rowRange("current").rows,u;n>=r.length&&(n=r.length-1);u=r[n];f.rowCommand(u,"Select",i);$().smartTag("hide")},systemFilter:function(n){var t=this._nodeFilter,i;if(n==null||n==!0)return t;n==!1?this._nodeFilter=null:(t||(t=this._nodeFilter=["collapse-nodes"]),i=Array.indexOf(t,n),i==-1?Array.add(t,n):Array.remove(t,n))},pageIndex:function(){var n=this._dataView;return n.get_pageIndex()},pageCount:function(){var n=this._dataView;return n.get_pageCount()},pageOffset:function(n){var t=this._dataView;if(n==null)return this._pageOffset!=null?this._pageOffset:0;this._pageOffset=n},scrollTopRow:function(n,t){t==null&&(t=!1);var i=this,s=this._dataView,l=this.totalRowCount(),u=s.get_pageSize(),f=t?l-u-n:n,e=Math.floor(f/u),a=f-e*u;i._goToPageTimeout!=-1&&clearTimeout(i._goToPageTimeout);i.pageOffset(a);var r=i.visibleDataRows(e),o=function(){r?i.refresh(r):s.goToPage(e,!1)},h=100,c=this._refreshSpeed;return c==null||c<75||t==!1?t&&!r?i._goToPageTimeout=window.setTimeout(o,500):o():(t&&!r&&(h=500),i._goToPageTimeout=window.setTimeout(o,h)),f},autoSize:function(n){var v=this,y,t,r,l,f,nt,a;if(v._refreshSpeed=null,n==!0){this._autoSizeTimeout&&clearTimeout(this._autoSizeTimeout);this._autoSizeTimeout=setTimeout(function(){v.autoSize();this._autoSizeTimeout=null},50);return}if(y=i.scrollTop(),t=this.$that(),t.is(":visible")){var p=this._dataView,e=p._fields,w=$(".container.resizable-data-view:visible");w.hide();t.outerWidth($(p._element).width());w.show();var u=this._$horizontalScrollbar,tt=u.find(".ui-slider-handle"),it=u.find(".ui-slider-handle-parent"),b=1+this.$that("_VSB").outerWidth();this.$that("_HSB").outerWidth(t.outerWidth()-b);var s=-1,o=-1,h=t.width()-b-t.find("div.header-cell.c0").position().left;t.find("div.data-row.first div.data-cell.fixed").each(function(){var n=$(this).width();h-=n;c+=n});var k=this.fixedColumns(),c=0,d=function(n){var t=$(n),i=t.is(":visible"),r;return i||t.show(),r=t.outerWidth(),i||t.hide(),r},rt=t.find("div.data-row.first div.data-cell").each(function(n){if(n>=k){var t=d(this),i=c+t;if(i>=h)return s=n,!1;c+=t}}),g=0;$(rt.get().reverse()).each(function(n){var t=d(this),i=g+t;if(i>=h)return o=e.length-n-k,!1;g+=t});r=s!=-1?e.length-s:0;r<o&&(r=o);this._rightMostFirstInvisibleColumn=o;u.slider("option","max",r);u.slider("option","value")>r&&u.slider("option","value",r);l=u.width();f=l;r>0?f=(e.length-r)/e.length*f:(this.$that("div.data-cell").show(),this.$that("div.header-cell").show());tt.css({width:f,"margin-left":-f/2});it.width(l-f);nt=this.$that(".header-row");a=this.$that("div.data-row.last");this.$that("_VSB").css({position:"absolute"}).height(a.position().top+a.outerHeight()).position({my:"right top",at:"right top",of:nt,collision:"none"});this._updatePageInfo();i.scrollTop(y)}},_syncVScrollBar:function(){var e,n;if(this._skipSyncVScrollBar){this._skipSyncVScrollBar=!1;return}var h=this._dataView,i=this._$verticalScrollbar,r=this.totalRowCount(),u=h.get_pageSize(),f=r<=u?0:r-u,o=i.slider("option"),s=this.topRowIndex(),t=r>u?r-u-s:0;t<0&&(t=0);o.max!=f?(i.slider("option","max",f),t>f&&(t=f-1),i.slider("option","value",t),this._$sliderPageInfo.hide()):o.value!=t&&(i.slider("option","value",t),this._$sliderPageInfo.hide());this._updatePageInfo(s);e=i.height();n=0;r>u&&(n=e*(u/r));n<10&&(n=10);this.$that("_VSB .scroll-bar").height("100%");i.slider("option","max")==0?(this._$vSliderHandleParent.height("100%").css("margin-top",0),this._$vSliderHandle.css({height:e,"margin-bottom":0})):(this._$vSliderHandleParent.height(e-n).css("margin-top",n/2),this._$vSliderHandle.css({height:n,"margin-bottom":-n/2}))},_updatePageInfo:function(t){var e=this._dataView,i=this.totalRowCount(),r=e.get_pageSize(),u,f;r>i&&(r=i);t==null&&(t=e.get_pageIndex()*r+this.pageOffset());u=t+r;u>=i&&(u=i,t=i-r);t++;this._$sliderPageInfo[0].innerHTML=String.format("{0} - {1}",t,u);f=n.DataViewResources;this._$pageShowing[0].innerHTML=i>0?String.format(f.Pager.ShowingItems,t,u,i):f.Data.NoRecords;this._$pagerRefresh.css({position:"absolute"}).position({my:"right middle",at:"right middle",of:this.$that("_Pager"),collision:"none"})},lookup:function(){return this.dataView().get_lookupField()},_contextMenuOfDataRow:function(n){var t=this;return[{text:"Select",select:function(){t.lookup()?t.rowCommand(n,"Select"):t.rowCommand(n,"Select","editForm1")}}]},sort:function(n){var r=this._dataView,t,i;if(n==null)return n=r.get_sortExpression(),t=n?n.match(/^(\w+?)(\s+(asc|desc))?$/):null,{fieldName:t?t[1]:null,order:t?t[3]:null};this.busy()||(this.pageOffset(0),r.sort(n),this._$headerCells.find(".status").removeClass("sort-asc sort-desc"),t=this.sort(),t.fieldName&&(i=this.fieldUnderAlias(t.fieldName),i&&this.header(i.Index).find(".status").addClass(t.order!="desc"?"sort-asc":"sort-desc")))},showRowNumber:function(){return this._dataView.get_showRowNumber()==!0},multiSelect:function(){return this._dataView.get_showMultipleSelection()},totalRowCount:function(){var n=this._dataView;return n._totalRowCount},pageSize:function(n){if(!this.busy()){var t=this._dataView;if(n==null)return t.get_pageSize();this._reset();t._clearCache();t.set_pageSize(n)}},_contextMenuOfColumn:function(t){var i=[],f=this,a=f._dataView,p=a._fields,h=p[t],c=a._allFields[h.AliasIndex],v=n.DataViewResources,r=v.HeaderFilter,y=v.Grid,o,s,e,u,l;if(c.AllowSorting){o=r.GenericSortAscending;s=r.GenericSortDescending;switch(c.FilterType){case"Text":o=r.StringSortAscending;s=r.StringSortDescending;break;case"Date":o=r.DateSortAscending;s=r.DateSortDescending}e=this.sort();u=c.Name;i.push({select:function(){f.sort(u)}});i.push({text:o,icon:"sort-asc",checked:e.fieldName==u&&e.order!="desc",select:function(){f.sort(u+" asc")}});i.push({text:s,icon:"sort-desc",checked:e.fieldName==u&&e.order=="desc",select:function(){f.sort(u+" desc")}})}return l=this.freeze()==h.Name,i.push({text:l?y.Unfreeze:y.Freeze,select:function(){f.freeze(l?"":h.Name)}}),i.length>0?i:[{text:"Header Item 1",select:function(){alert("header 1")}},{text:"Header item number 2",select2:function(){alert("header 2")},children:[{text:"Header Sub Item 1",select:function(){alert("header sub item 1")}},{text:"Header Sub Item 2",select:function(){alert("header sub item 2")}},{text:"Header Sub Item 3",select:function(){alert("header sub item 3")}},{text:"Header Sub Item 4",select:function(){alert("header sub item 4")}},{text:"Header Sub Item 5",select:function(){alert("header sub item 5")}}]},{text:"item #3",select:function(){alert("header 3")}}]},cursor:function(t,i,r){var a=this._dataView,e,u;if(n.DataView.Extensions.active(this)||(t=!1),e=this.$that(),u=this._cursor,u||(u=this._cursor={left:$('<div class="cursor left"><\/div>').appendTo(e).css({position:"absolute",width:"3px"}).hide(),top:$('<div class="cursor top"><\/div>').appendTo(e).css({position:"absolute",height:"3px"}).hide(),right:$('<div class="cursor right"><\/div>').appendTo(e).css({position:"absolute",width:"3px"}).hide(),bottom:$('<div class="cursor bottom"><\/div>').appendTo(e).css({position:"absolute",height:"3px"}).hide(),row:0,col:0}),t==null)return u;if(this._$dataGaps.removeClass("cursor"),this._$headerCells.removeClass("cursor"),t){i!=null&&(u.row=i);r!=null&&(u.col=r);var c=this.pageSize(),l=this.topRowIndex(),o=u.row-l;if(o<0||o>=c)this.cursor(!1);else{var f=this.cell(o,u.col),s=f.outerHeight()-3,h=f.outerWidth()+3;u.left.height(s).show().position({my:"left top",at:"left-2 top+1",of:f,collision:"none"});u.top.width(h).show().position({my:"left top",at:"left-2 top-2",of:f,collision:"none"});u.right.height(s).show().position({my:"left top",at:"right-2 top+1",of:f,collision:"none"});u.bottom.width(h).show().position({my:"left top",at:"left-2 bottom-2",of:f,collision:"none"});this.gap(o).gap.addClass("cursor");this.header(u.col).addClass("cursor")}}else u.left.hide(),u.top.hide(),u.right.hide(),u.bottom.hide()}}})();